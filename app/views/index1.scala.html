
@main("???????") {

    <div class="container" style="margin-top: 70px;" ng-controller="mainCtrl">
        <div class="mainsearch col-md-12">
            <div class="searchform">
                <form class="form-inline">
                    <div class="form-group col-md-5">
                        <input style="width: 100%" type="text" ng-model="key" class="form-control" id="searchkey" placeholder="??????? ????????? ?????">
                    </div>
                    <div  class="form-group col-md-3">
                        <input id="citysel" style="width: 100%" ng-model="selectedAddr" ng-change="cityInput()" type="text" typeahead="address as address.formatted_address for address in locations | limitTo:10"
                        typeahead-loading="loadingLocations" typeahead-no-results="noResults" class="form-control" autocomplete="off" placeholder="??????? ?????">
                    </div>
                    <div class="form-group col-md-3">
                        <select style="width: 100%" class="form-control"  ng-model="categories.selectedCat" ng-options="option.name for option in categories.availableCat track by option.id" id="searchcategory" placeholder="???????? ???????" autocomplete="off">
                        </select>
                    </div>
                    <button type="submit" class="btn btn-default col-md-1" ng-click="search();">?????</button>
                </form>
            </div>
            <div class="searchcategories col-md-12" style="position: relative">
                <div class="col-md-offset-6 up" style="position: absolute; z-index: 100;"><img src="@routes.Assets.at("images/up.png")"/></div>

                <div class="col-md-12 selectregion">
                    <div class="col-md-3">
                        <p>????????? ???????</p>
                        <p>????????? ???????</p>
                        <p>???????????????? ???????</p>
                        <p>???????? ???????</p>
                        <p>??????????? ???????</p>
                        <p>???????????? ???????</p>
                        <p>??????????? ???????</p>
                    </div>
                    <div class="col-md-3">
                        <p>?????-??????????? ???????</p>
                        <p>???????? ???????</p>
                        <p>?????????????? ???????</p>
                        <p>????</p>
                        <p>????????? ???????</p>
                        <p>????????? ???????</p>
                        <p>???????????? ???????</p>
                    </div>
                    <div class="col-md-3">
                        <p>???????? ???????</p>
                        <p>?????????? ???????</p>
                        <p>????????? ???????</p>
                        <p>??????? ???????</p>
                        <p>????????????? ???????</p>
                        <p>??????????? ???????</p>
                        <p>?????????? ???????</p>
                    </div>
                    <div class="col-md-3">
                        <p>??????????? ???????</p>
                        <p>?????????? ???????</p>
                        <p>???????????? ???????</p>
                        <p>??????????? ???????</p>
                    </div>
                </div>
                <ul>
                    <li>1</li>
                    <li>2</li>
                    <li>3</li>
                    <li>4</li>
                </ul>
            </div>
        </div>
        <h3>????? ??????????</h3>
        <div class="col-sm-3" ng-repeat="announcement in announcements">
            <div class="panel panel-primary"  ng-click="showAn(announcement.id)" style="cursor: pointer;">
                <div class="panel-heading" style="font-weight: bold;">
                    {{announcement.title | limitTo:18}}
                    <span ng-if="announcement.type == 'found'" class="label label-success" style="float: right;">???????</span>
                    <span ng-if="announcement.type == 'lost'" class="label label-danger" style="float: right;">????????</span>
                </div>
                <div class="panel-body">
                    <img height="100"  ng-src="/assets/{{announcement.photo}}"/>
                    <br>
                    <span style="color: blue;">{{announcement.city}}</span>
                </div>
            </div>
        </div>

    </div>

    <script>
        $(".selectregion").hide();
        $(".up").hide();
       $.ajax({
            type: 'POST',
            url: '@routes.Account.checkSession()',
            success: function(data){

                if(data.error == ""){
                    var name = data.email.substring(0, data.email.lastIndexOf("@@"));

                    var menu = "<a href='#' class='dropdown-toggle' data-toggle='dropdown' role='button' aria-expanded='false'>"+name+"<span class='caret'></span></a>"+
                                "<ul class='dropdown-menu' role='menu'>"+
                                "<li><a href='/account'>???????</a></li>"+
                                "<li><a href='#'>Another action</a></li>"+
                                "<li class='divider'></li>"+
                                "<li id='signOut'><a href='#'>?????</a></li>"+
                                "</ul>";
                    $("#profile-link").html(menu);

                }else{
                     $("#profile-link").html("<a href='/account/signin'>???????</a></li>");
                }
            }
        });

         angular.module('lostfoundApp', ['ui.bootstrap'])
        .controller('mainCtrl', function($scope, $http) {

                $scope.selectedAddr = {"regionId":0,"cityId":0, formatted_address:""};
                $scope.key = "";

                $http.get('@routes.Announcement.getCategories()')
                 .success(function(data){
                    console.log(data);
                    var availableCat = data;
                    availableCat.unshift({"id":0,"name":"??? ???????"});
                    var categories = {"availableCat":availableCat, "selectedCat":{"id":0,"name":"??? ???????"}};
                    $scope.categories = categories;
                 }).error(function(data){
                    console.log(data);
                 });


                $http.get('@routes.Announcement.getLast12()')
                 .success(function(data){
                    console.log(data);
                    $scope.announcements = data;
                 }).error(function(data){
                    console.log(data);
                 });

              $scope.$watch('selectedAddr', function() {
               return $http.get('@routes.Announcement.getAddress()', {
                params: {
                q: $scope.selectedAddr
                  }
                })
               .then(function(response){
                    console.log(response);
                    $scope.locations = response.data;
               });
            });

            $scope.search = function(){
                console.log($scope.selectedAddr);
                window.location.href = "/results?key="+$scope.key+"&regionId="+$scope.selectedAddr.regionId+"&cityId="+$scope.selectedAddr.cityId+"&categoryId="+$scope.categories.selectedCat.id;
            }

            $scope.showAn = function(id){
                console.log(id);
                window.location.href = "/announcement/show?id="+id;
            }

            $scope.cityInput = function(){
                console.log("ng-change input");
                $(".selectregion").hide();
                $(".up").hide();
            }

            $("#citysel").focusin(function(){
                $(".selectregion").show();
                $(".up").show();
            });

            $("#citysel").focusout(function(){
                $(".selectregion").hide();
                $(".up").hide();
            });

        })
    </script>

}
