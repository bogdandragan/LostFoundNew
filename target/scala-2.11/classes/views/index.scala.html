
@main("Главная") {

    <div class="container" style="margin-top: 70px;" ng-controller="mainCtrl">
        <h3>Новые обьявления</h3>
        <div class="col-sm-4" ng-repeat="announcement in announcements">
            <div class="panel panel-primary" >
                <div class="panel-heading" style="font-weight: bold;">
                    {{announcement.title | limitTo:30}}
                    <span ng-if="announcement.type == 'found'" class="label label-success" style="float: right;">Найдено</span>
                        <span ng-if="announcement.type == 'lost'" class="label label-danger" style="float: right;">Потеряно</span>
                </div>
                <div class="panel-body">
                    {{announcement.description | limitTo:35}}...
                    <br>
                    <span style="color: blue;">{{announcement.city}}, {{announcement.region}}</span>
                </div>
            </div>
        </div>

    </div>

    <script>
       $.ajax({
            type: 'POST',
            url: '@routes.Account.checkSession()',
            success: function(data){

                if(data.error == ""){
                    var name = data.email.substring(0, data.email.lastIndexOf("@@"));

                    var menu = "<a href='#' class='dropdown-toggle' data-toggle='dropdown' role='button' aria-expanded='false'>"+name+"<span class='caret'></span></a>"+
                                "<ul class='dropdown-menu' role='menu'>"+
                                "<li><a href='/account'>Профиль</a></li>"+
                                "<li><a href='#'>Another action</a></li>"+
                                "<li class='divider'></li>"+
                                "<li id='signOut'><a href='#'>Выход</a></li>"+
                                "</ul>";
                    $("#profile-link").html(menu);

                }else{
                     $("#profile-link").html("<a href='/account/signin'>Профиль</a></li>");
                }
            }
        });

         angular.module('lostfoundApp', ['ui.bootstrap'])
        .controller('mainCtrl', function($scope, $http) {

                //get categories
                $http.get('@routes.Announcement.getLast12()')
                 .success(function(data){
                    console.log(data);
                    $scope.announcements = data;
                 }).error(function(data){
                    console.log(data);
                 });

        })
    </script>

}
